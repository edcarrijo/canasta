<div class="row justify-content-end">
    <div class="col offset-11">
        <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
            <div class="btn-group mr-2" role="group" aria-label="First group">
                <button type="button" class="btn btn-secondary" (click)="invertPlayersSwitch()">
                    <fa-icon [icon]="['fas', 'exchange-alt']"></fa-icon>
                </button>
                <button type="button" class="btn btn-secondary" (click)="hideMyHandSwitch()" [ngClass]="{'active': hideMyHand}">
                    <fa-icon [icon]="['fas', 'eye-slash']"></fa-icon>
                </button>
                <button type="button" class="btn btn-secondary" (click)="undo()">
                    <fa-icon [icon]="['fas', 'undo-alt']"></fa-icon>
                </button>
            </div>
        </div>
    </div>
</div>

<main class="p-3">
  <div class="fluid-container">
    
    <div class="row justify-content-md-center">
      <div [ngClass]="{'col order-1': !inverted, 'col-2 order-2': inverted}">
          <div class="d-flex flex-row" [ngClass]="{'flex-row-reverse': inverted}">
                <button type="button" class="btn btn-light d-block action-button" (click)="opponent1Action.open()" title="Opponent 1">
                 <fa-icon [icon]="['fas', 'user-secret']"></fa-icon>
                </button> 
          </div>
          <div class="d-flex flex-row" [ngClass]="{'flex-row-reverse': inverted}">
                <canasta-card-back [count]="state.play.opponent1.handCount"></canasta-card-back>
          </div>
      </div>
      <div [ngClass]="{'col-2 order-2': !inverted, 'col order-1': inverted}">
          <div class="d-flex flex-row" [ngClass]="{'flex-row-reverse': !inverted}">
                <button type="button" class="btn btn-light d-block action-button" (click)="partnerAction.open()" title="Partner">
                        <fa-icon [icon]="['fas', 'user-shield']"></fa-icon>
                  </button> 
          </div>
          <div class="d-flex flex-row" [ngClass]="{'flex-row-reverse': !inverted}">
                <canasta-card-back [count]="state.play.partner.handCount"></canasta-card-back>
          </div>
      </div>
    </div>
    <div class="game-table">
      <div class="row">
          <div class="col-2">
              <canasta-card *ngFor="let card of state.play.table.opponentGame.redThrees" [card]="card"></canasta-card>
          </div>
          <div class="col">
              <p>OPPONENT SIDE</p>
              <canasta-card-meld *ngFor="let meld of state.play.table.opponentGame.melds" [meld]="meld"></canasta-card-meld>
          </div>
      </div>
      <div class="neutral-zone">
          <div class="d-flex flex-row justify-content-between">
            <div>
                <p>SIDE DECK</p>
                <canasta-card-back *ngIf="state.play.table.sideDeck1Avaible"></canasta-card-back>
                <canasta-card-back *ngIf="state.play.table.sideDeck2Avaible"></canasta-card-back>
            </div>
            <div>
                <p>DISCARD</p>
                <canasta-card *ngIf="lastDiscard" [card]="lastDiscard"></canasta-card>
            </div>
            <div>
                <p>DECK</p>
                <canasta-card-back [count]="state.play.table.maindDeckCount"></canasta-card-back>
            </div>
          </div>
      </div>
      <div class="row">
          <div class="col-2">
              <canasta-card *ngFor="let card of state.play.table.myGame.redThrees" [card]="card"></canasta-card>
          </div>
          <div class="col">
              <p>MY SIDE</p>
              <canasta-card-meld *ngFor="let meld of state.play.table.myGame.melds; let i = index" 
                [meld]="meld"
                (addCardClick)="addMeldCard($event, i)"></canasta-card-meld>
          </div>
      </div>
    </div>
    
    <div class="row">
      <div class="col" [ngClass]="{'order-1': !inverted, 'order-2': inverted}">
          <div class="d-flex flex-row" [ngClass]="{'flex-row-reverse': inverted}">
            <button type="button" class="btn btn-light d-block action-button" (click)="meAction.open()" 
                title="Me">
                    <fa-icon [icon]="['fas', 'laptop']"></fa-icon>
            </button> 
          </div>
        <div class="d-flex flex-row" [ngClass]="{'flex-row-reverse': inverted}">
            <div class="d-inline" *ngFor="let card of state.play.me.hand">
                    <canasta-card *ngIf="!hideMyHand" [card]="card" [ngClass]="{'float-right': inverted}"></canasta-card>
                    <canasta-card-back *ngIf="hideMyHand"></canasta-card-back>
            </div>
        </div>
      </div>
      <div class="col-2" [ngClass]="{'order-2': !inverted, 'order-1': inverted}">
          <div class="d-flex flex-row" [ngClass]="{'flex-row-reverse': !inverted}">
                <button type="button" class="btn btn-light d-block action-button" (click)="opponent2Action.open()" title="Opponent 2">
                 <fa-icon [icon]="['fas', 'user-secret']"></fa-icon>
                </button> 
          </div>
          <div class="d-flex flex-row" [ngClass]="{'flex-row-reverse': !inverted}">
                <canasta-card-back [count]="state.play.opponent2.handCount"></canasta-card-back>
          </div>
      </div>
    </div>
    </div>
</main>

<canasta-player-action [player]="me" [hand]="state.play.me.hand" modalId="meAction" (actionDone)="actionDone($event)" #meAction></canasta-player-action>
<canasta-player-action [player]="partner" [hand]="state.play.partner.hand" modalId="partnerAction" (actionDone)="actionDone($event)" #partnerAction></canasta-player-action>
<canasta-player-action [player]="opponent1" [hand]="state.play.opponent1.hand" modalId="opponent1Action" (actionDone)="actionDone($event)" #opponent1Action></canasta-player-action>
<canasta-player-action [player]="opponent2" [hand]="state.play.opponent2.hand" modalId="opponent2Action" (actionDone)="actionDone($event)" #opponent2Action></canasta-player-action>

<pre hidden>
  {{ state.table | json }}
</pre>